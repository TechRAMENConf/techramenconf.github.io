---
import { getPersonalSponsors } from "../../utils/csvData";
import PersonalSponsorImage from "./PersonalSponsorImage.astro";

// Fetch personal sponsors from CSV data
const personalSponsors = await getPersonalSponsors();
---

<section class="section-colored section-accent" id="personal-sponsors">
  <div class="container">
    <h2 class="text-center mb-12">
      <span class="title-plate title-plate-xl">ラーメン<span class="tape-correction">応援</span>団</span>
    </h2>
    
    <div class="card p-8 md:p-12 max-w-4xl mx-auto">
      <!-- Sponsor Status Panel -->
      <div class="led-panel mb-6 flex justify-center">
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="led-indicator led-sm led-red led-pulse"></div>
            <span class="text-xs font-mono text-gray-600">SUPPORT ACTIVE</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="led-indicator led-sm led-green"></div>
            <span class="text-xs font-mono text-gray-600">MEMBERS: {personalSponsors.length}</span>
          </div>
        </div>
      </div>
      
      <div class="flex flex-wrap justify-center gap-4">
        {
          personalSponsors.map((sponsor) => (
            <div class="relative group">
              {sponsor.twitterUrl ? (
                <a href={sponsor.twitterUrl} class="block transition-transform hover:scale-110" target="_blank" rel="noopener noreferrer">
                  <PersonalSponsorImage avatarUrl={sponsor.avatarUrl} />
                </a>
              ) : (
                <div class="transition-transform hover:scale-110">
                  <PersonalSponsorImage avatarUrl={sponsor.avatarUrl} />
                </div>
              )}
              <div class="absolute z-10 p-2 -mt-2 text-sm text-gray-800 bg-white rounded-lg opacity-0 transition-opacity duration-300 group-hover:opacity-100 left-1/2 transform -translate-x-1/2 top-full border border-yellow-200 shadow-lg">
                {sponsor.displayName || sponsor.userName}
                {sponsor.comment && (
                  <div class="text-xs text-gray-600 mt-1">{sponsor.comment}</div>
                )}
              </div>
            </div>
          ))
        }
      </div>
      
      <div class="mt-12 text-center">
        <p class="text-gray-700 mb-6 font-kikai">
          いわゆる "個人スポンサー" 的な形で<span class="tape-correction">応援</span>していただける方を募集しています
        </p>
        <a href="https://note.com/tomio2480/n/n9280fae6ab29?magazine_key=m8fb20b0824ea" class="btn btn-primary">
          <span class="tape-correction">応援</span>団員になる
        </a>
      </div>
    </div>
  </div>
</section>
